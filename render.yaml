# Render Blueprint - Khaznati DZ
# This file tells Render how to deploy your application
# Uses: Supabase (database) + Telegram Bot (file storage)

services:
  # ============================================
  # BACKEND - FastAPI Python Application
  # ============================================
  - type: web
    name: khaznati-backend
    runtime: python
    region: frankfurt  # Choose: oregon, ohio, virginia, frankfurt, singapore
    plan: free  # Options: free, starter, standard, pro
    rootDir: backend
    buildCommand: pip install -r requirements.txt
    startCommand: uvicorn app.main:app --host 0.0.0.0 --port $PORT
    healthCheckPath: /health
    envVars:
      # Application Settings
      - key: APP_NAME
        value: Khaznati DZ
      - key: APP_ENV
        value: production
      - key: DEBUG
        value: false
      - key: SECRET_KEY
        sync: false  # Enter your existing SECRET_KEY
      
      # Supabase Database
      - key: SUPABASE_URL
        sync: false  # Enter your Supabase URL
      - key: SUPABASE_KEY
        sync: false  # Enter your Supabase anon/service key
      
      # Telegram Bot (for file storage)
      - key: API_ID
        sync: false  # Your Telegram API ID
      - key: API_HASH
        sync: false  # Your Telegram API Hash
      - key: BOT_TOKEN
        sync: false  # Your Telegram Bot Token
      - key: STORAGE_CHANNEL_ID
        sync: false  # Your Telegram Channel ID for storage
      - key: CHUNK_SIZE
        sync: false  # Chunk size for uploads
      
      # Email (Resend)
      - key: RESEND_API_KEY
        sync: false  # Your Resend API key
      - key: RESEND_FROM_EMAIL
        sync: false  # Your from email address
      
      # CORS
      - key: ALLOWED_ORIGINS
        sync: false  # Your frontend URL
      
      # Optional settings
      - key: MULTI_USER
        sync: false

  # ============================================
  # FRONTEND - Vite Static Site
  # ============================================
  - type: web
    name: khaznati-frontend
    runtime: static
    rootDir: frontend
    buildCommand: npm install && npm run build
    staticPublishPath: dist
    headers:
      - path: /*
        name: X-Frame-Options
        value: DENY
      - path: /*
        name: X-Content-Type-Options
        value: nosniff
    routes:
      # Single Page App - redirect all routes to index.html
      - type: rewrite
        source: /*
        destination: /index.html
    envVars:
      - key: VITE_API_URL
        sync: false  # Set this to your backend URL

# NOTE: We're NOT creating a database here because you're using Supabase
# Your Supabase database is already set up externally
