# Render Blueprint - Khaznati DZ
# This file tells Render how to deploy your entire application
# Documentation: https://render.com/docs/blueprint-spec

services:
  # ============================================
  # BACKEND - FastAPI Python Application
  # ============================================
  - type: web
    name: khaznati-backend
    runtime: python
    region: frankfurt  # Choose: oregon, ohio, virginia, frankfurt, singapore
    plan: free  # Options: free, starter, standard, pro
    rootDir: backend
    buildCommand: pip install -r requirements.txt
    startCommand: uvicorn app.main:app --host 0.0.0.0 --port $PORT
    healthCheckPath: /health
    envVars:
      # Application Settings
      - key: APP_NAME
        value: Khaznati DZ
      - key: APP_ENV
        value: production
      - key: DEBUG
        value: false
      - key: SECRET_KEY
        generateValue: true  # Render auto-generates a secure key
      
      # Database - Will be filled after creating the database
      - key: DATABASE_URL
        fromDatabase:
          name: khaznati-db
          property: connectionString
      
      # Session & Security
      - key: SESSION_SECRET
        generateValue: true
      - key: CSRF_SECRET
        generateValue: true
      - key: ALLOWED_ORIGINS
        sync: false  # Set manually: your frontend URL
      
      # S3 Storage - Set these manually in Render dashboard
      - key: STORAGE_BACKEND
        value: s3
      - key: S3_ENDPOINT_URL
        sync: false
      - key: S3_ACCESS_KEY_ID
        sync: false
      - key: S3_SECRET_ACCESS_KEY
        sync: false
      - key: S3_BUCKET_NAME
        sync: false
      - key: S3_REGION
        value: auto
      
      # Email - Set manually
      - key: SMTP_HOST
        sync: false
      - key: SMTP_PORT
        value: "587"
      - key: SMTP_USER
        sync: false
      - key: SMTP_PASSWORD
        sync: false
      
      # File Upload
      - key: MAX_UPLOAD_SIZE_MB
        value: "500"
      - key: CHUNK_SIZE_MB
        value: "5"
      
      # Localization
      - key: DEFAULT_LANGUAGE
        value: ar
      - key: SUPPORTED_LANGUAGES
        value: ar,fr,en

  # ============================================
  # FRONTEND - Vite Static Site
  # ============================================
  - type: web
    name: khaznati-frontend
    runtime: static
    plan: free
    rootDir: frontend
    buildCommand: npm install && npm run build
    staticPublishPath: dist
    headers:
      - path: /*
        name: X-Frame-Options
        value: DENY
      - path: /*
        name: X-Content-Type-Options
        value: nosniff
    routes:
      # Single Page App - redirect all routes to index.html
      - type: rewrite
        source: /*
        destination: /index.html
    envVars:
      - key: VITE_API_URL
        sync: false  # Set this to your backend URL

# ============================================
# DATABASE - PostgreSQL
# ============================================
databases:
  - name: khaznati-db
    plan: free  # Options: free, starter, standard, pro
    region: frankfurt
    databaseName: khaznati
    user: khaznati_user
