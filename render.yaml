# Render Blueprint - Khaznati DZ (Single Web Service)
# This file tells Render how to deploy your application as a single unit
# Both Backend and Frontend are served from this one service

services:
  - type: web
    name: khaznati-dz
    runtime: python
    region: frankfurt
    plan: free
    # Root directory is empty because we're at the root of the project
    buildCommand: cd backend && pip install -r requirements.txt && cd ../frontend && npm install && npm run build
    # We use uvicorn to start the FastAPI app
    startCommand: cd backend && uvicorn app.main:app --host 0.0.0.0 --port $PORT
    healthCheckPath: /api/health
    envVars:
      # Application Settings
      - key: APP_NAME
        value: Khaznati DZ
      - key: APP_ENV
        value: production
      - key: DEBUG
        value: false
      - key: SECRET_KEY
        generateValue: true
      - key: SESSION_SECRET
        generateValue: true
      
      # Supabase Database
      - key: SUPABASE_URL
        sync: false  # Enter your Supabase URL in Render Dashboard
      - key: SUPABASE_KEY
        sync: false  # Enter your Supabase anon/service key in Render Dashboard
      
      # Telegram Bot (for file storage)
      - key: API_ID
        sync: false  # Your Telegram API ID
      - key: API_HASH
        sync: false  # Your Telegram API Hash
      - key: BOT_TOKEN
        sync: false  # Your Telegram Bot Token
      - key: STORAGE_CHANNEL_ID
        sync: false  # Your Telegram Channel ID for storage
      
      # CORS (Self-referencing for single service)
      - key: ALLOWED_ORIGINS
        value: https://khaznati-dz.onrender.com
      
      # Python Version
      - key: PYTHON_VERSION
        value: 3.11.7
